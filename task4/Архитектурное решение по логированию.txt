
1. Какие логи нужно собирать: 
    -InternetShop, лог работы Customer'ов 
    - CRM, лог работы Seller'ов   
    - CRM API, лог поступления заказов через очередь
    - MES, лог работы Операторов
    - MES API, лог работы API users
2. Cписок необходимых логов с уровнем INFO.
   InternetShop, лог работы Customer'ов
     Вход на сайт, просмотр страницы, переход по ссылке. IP, время 
     Создание пользователя.  Логин, время
     Вход/выход пользователя в кабинет. Кто, время
     Создание заказа. Кто, время, параметры
     Изменение заказа. Кто, время, старое значение и новое значение
   CRM, лог работы Seller'ов   
     Вход/выход пользователя. Кто, время
     Создание заказа. Кто, время, параметры
     Изменение заказа. Кто, время, старое значение и новое значение     
   CRM API, лог поступления заказов через очередь
     Поступление заказа через очередь. Идентификатор заказа, время
   MES, лог работы Операторов
     Вход/выход пользователя. Кто, время
     Привязка заказа к оператору. Кто, заказ, оператор, время
     Просмотр списка заказов. Кто, когда, параметры фильтра, время выборки данных
   MES API, лог работы API users
     Вход/выход пользователя. Кто, время
     Создание заказа. Кто, время, параметры
     Изменение заказа. Кто, время, старое значение и новое значение 
     Время расчета заказа. Кто, время, заказ, время расчета   

     Другие уровни логирования и при каких обстоятельствах
       FATAL — при отказе сервиса или оборудования.
       ERROR — при ошибочном состояние.
       WARN —  при состоянии близком к нестандартному поведению системы.

Мотивация
1. Для чего нужно добавить логирование, что это даст компании: 
   - Улучшение отладки компонент 
   - Сбор и анализ данных о работе системы
   - Обнаружение ошибок
   - Получение инсайтов
   - Данные для мониторинга
   Данные мероприятия приведу к лучшей наблюдаемости системы -> 
     снижению количества ошибок, снижению стоимости владения и поддержки, улучшению качества ПО и уровня обслуживания клиентов -> 
       увеличению количества клиентов, увеличение прибыли
2. Технические и бизнес-метрики решения, на которые может повлиять внедрение логирования
   Технические метрики
     -Доступность системы (сервисов) - %
     -Производительность (сервисы) - TRS, RPS, Latency, Response time
     -Время восстановления - MTTR, MTTF
     -Стабильность - Crash rate, Connection count
     -Надежность - Error rate, Success rate, Retry rate
   Бизнес-метрики
     -Time to market
     -MAU/DAU
     -Retention Rate
     -CSAT
     -Bug rate/incident rate
     -Deployment Freqency
     -Lead time for changes
3. В первую очередь необходимо настроить логирование и трейсинг в тех местах:
     - где зафиксированы проблемы и жалобы
     - где исправление ситуации позволит повысить бизнес-метрики (с учетом баланса краткосрочно/долгосрочно)
     Сервисы по приоритетам:
       MES, лог работы Операторов
       MES API, лог работы API users
       CRM, лог работы Seller'ов   
       CRM API, лог поступления заказов через очередь

Предлагаемое решение
1. Технологий реализации логирования, компоненты для внедрения и доработки: 
   1. Все сервисы MES, MES API, CRM, CRM API, Shop API, Internet Shop напавляют логи в топик Kafka
   2. Logstash читает сообщения из Kafka + PostgreSQL, RabbitMQ, S3 и обрабатывает централизованно все логи, передает их в ElasticSearch
   3. Логи хранятся в ElasticSearch
   4. Kibana предоставляет доступ к визуализации и работе с логами 
3. Политика безопасности в отношении логов.
     Тк в логах буду персональные данные и, возможно, номера карт, то
      - персональные данные и номера карт будут маскироваться
      - данные будут подписываться и шифроваться
      - доступ к логам будет регулироваться ролевой моделью, для просмотра логов введем роль - Поддержка_Logs
        доступ будет ограничен в Kafka, Logstash, ElasticSearch, Kibana
4. Политику хранения в отношении логов:
     - будет отдельный индекс под систему 
     - храниться 6 месяцев на шардах по 100Gb далее бэкаптруются 
     - размера трудно оценить, при горизонтальном масштабировании - не ограничено 
5. Мероприятия для превращения системы сбора логов в систему анализа логов:
   1. В рамках сервиса Logstash сделать отдельный процесс по сборке логов и нормализации из для аналитических запросов
   2. Выделить в ElasticSearch отдельную схему данных для аналитического хранения логов
   3. Разработать отдельный сервис, который проводит анализ логов и алтеринг
